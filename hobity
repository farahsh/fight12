package aufgabe12;

import java.util.Scanner;

public class Drachenkampf {
	
	public static void main(String[] args) {
		
		
		char input;
		
		Scanner sc = new Scanner(System.in);

		System.out.println("Please Enter the Arena Dimensions: ");
		int d = sc.nextInt();
		System.out.println("The figth begins...");
		int hpPlayer = 20;
		int hpDragon = 20;
		int bowAndArrow = 4;
		int sword = 3;
		int dragonFire = 5;
		
		

		int x = 1;
		int y = d/2;
//while		
		while (hpPlayer > 0 && hpDragon > 0 ) {
			drawArena(d, x, y);
			System.out.print("Leben des Helden:  ");
			for (int i = hpPlayer; i > 0; i--) {
				System.out.print("O ");
			}
			System.out.println();
			System.out.print("Leben des Drachen: ");
			for (int i = hpDragon; i > 0; i--) {
				System.out.print("X ");
			}
			System.out.println();
			System.out.println();
		
		
		boolean validMove = false;

		while(validMove == false){
			System.out.println("To Move use WASD and Q to stay at your current posision: ");
			input = sc.next().charAt(0);
			int[] coo = move(x, y, input, sc);
			movable(coo[0], coo[1], d);
			if(movable(coo[0], coo[1], d) == true){
				x = coo[0];
				y = coo[1];
				//change to true
				validMove = true;
				
			} else {
				System.out.println("move didn't return true and you can't move");
				validMove = false;
			}
		}
		
		drawArena(d, x, y);
		
		System.out.println("Der Held kann mit Pfeil und Bogen (1) oder mit dem Schwert (2) angreifen.");
		int weapon = sc.nextInt();
		int random1 = (int) (Math.random() * 100);
		if (weapon == 1) {
			if ( random1 <= 60 +(40/d)*(distance(x , d)) ) {
				hpDragon -= bowAndArrow;
				System.out.println("Der Drache wurde getroffen.");
			} else {
				System.out.println("Der Drache wurde verfehlt.");
			}
			
		} else if (weapon == 2) {
			if (distance(x, d) == 1){
				if ( random1 <= 70 ) {
					hpDragon -= sword;
					System.out.println("Der Drache wurde getroffen.");
				} else {
					System.out.println("Der Drache wurde verfehlt.");
				}
			} else { 
				System.out.println("you cant do diz");
				
			}
			continue;
			
		} else {
			System.out.println("Bitte geben Sie eine gültige Auswahl ein!");
			continue;
		}
/**
* this "if" statement is used so that the while loop will 
* break if the dragon dies without letting the Dragon
* have another turn:
**/
		if (hpDragon <= 0) {
			break;
		}
//here's the dragon's turn:
		int random2 = (int) (Math.random() * 100);
		if (random2 <= 50) {
			hpPlayer -= dragonFire;
			System.out.println("Der Held wurde verletzt.");
		} else {
			System.out.println("Der Drache hatte eine Fehlzündung. Glück gehabt.");
		}
	}

	}
  	public static int[] move(int x, int y,char input, Scanner sc){
  		int[] coo = new int [2];
  		boolean looping = true;
  		
  		while (looping == true){
  			
  			
  			// change this input to main...
  			
  			switch (input) {
  				case 'w':
  					x -= 1;
  					looping = false;
  					break;
  				case 'a': 
  					y-= 1;
  					looping = false;
  					break;
  				case 's': 
  					x += 1;
  					looping = false;
  					break;
  				case 'd': 
  					y += 1;
  					looping = false;
  					break;
  				case 'q': 
  					looping = false;
  					break;
  					
				default :
					looping = true;
					System.out.println("Please Enter a valid value: ");
					continue;
  			}
		}
  		coo[0] = x;
  		coo[1] = y;
  		looping = true;
  		return coo;
	}
	

  	
		
	public static boolean movable(int x, int y, int d) {
		boolean moving;
		if (x == 0 || y == 0){
			moving = false;
		} else if (x == d-1 || y == d-1 ) {
			moving = false;
		} else if (x == d - 2 && y == d/2) {
			moving = false;
		} else {
			moving = true;
		}
	return moving;
	}

	
	
	
	
	public static int distance(int x, int d ){
		int distance = d - x - 2;
		return distance;
	}
	

	
	public static void drawArena(int d2, int x2, int y2) {
		char[][] field = new char[d2][d2];
		int j = 0;
		int i = 0;
		while(j < d2) {
			for (i = 0;i<field.length;i++){
				if (x2 == j && y2 == i){
					field[j][i] =  'P';
				} else if ((j == d2 -2) && (i == d2/2)){
					field[j][i] =  'D';
				} else if ((j >= 1 && j < d2 - 1) && (i >= 1 && i < d2 - 1) ) {
					field[j][i] =  ' ';
				} else {
					field[j][i] = '#';
				}
				System.out.print(field[j][i]);
			}
			j++;
			System.out.println();
		}
	}
}
